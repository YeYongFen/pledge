{"version":3,"file":"promise.js","sources":["../src/promise/error.js","../src/promise/utils.js","../src/promise/asap.js","../src/promise/promise.js","../src/index.js"],"sourcesContent":["const constructorErrorText = 'Failed to construct \\'Promise\\': Please use the \\'new\\' operator, this object constructor cannot be called as a function.';\r\nconst resolverErrorText = 'You must pass a resolver function as the first argument to the promise constructor';\r\nconst resolveSelfErrorText = 'You cannot resolve a promise with itself';\r\nconst cannotReturnOwnText = 'A promises callback cannot return that same promise.';\r\nconst validationErrorText = 'Array Methods must be provided an Array';\r\nconst needsResolverText = 'You must pass a resolver function as the first argument to the promise constructor';\r\n\r\nexport const constructorError = () => new TypeError(constructorErrorText);\r\n\r\nexport const resolverError = () => new TypeError(resolverErrorText);\r\n\r\nexport const resolveSelfError = () => new TypeError(resolveSelfErrorText);\r\n\r\nexport const cannotReturnOwn = () => new TypeError(cannotReturnOwnText);\r\n\r\nexport const validationError = () => new Error(validationErrorText);\r\n\r\nexport const needsResolver = () => new TypeError(needsResolverText);\r\n","export const isObject = (val) => {\r\n  return val !== null && typeof val === 'object';\r\n};\r\n\r\nexport const isFunction = (val) => {\r\n  return toString.call(val) === '[object Function]';\r\n};\r\n\r\nexport const noop = () => {}\r\n;\r\n","\r\nlet queue = [];\r\nlet index = 0;\r\n// let flushing = false;\r\nlet capacity = 1024;\r\n\r\nconst browserWindow = (typeof window !== 'undefined') ? window : undefined;\r\nconst browserGlobal = browserWindow || {};\r\nconst BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\r\n\r\nconst requestFlush = (function () {\r\n  if (BrowserMutationObserver) {\r\n    return makeMutationObserver(flush);\r\n  } else {\r\n    return makeMutationTimeout(flush);\r\n  }\r\n})();\r\n\r\nfunction makeMutationObserver (callback) {\r\n  let toggle = 1;\r\n  const observer = new BrowserMutationObserver(callback);\r\n  const node = document.createTextNode('');\r\n  observer.observe(node, { characterData: true, });\r\n  return () => {\r\n    node.data = --toggle;\r\n  };\r\n};\r\n\r\nfunction makeMutationTimeout (callback) {\r\n  return () => setTimeout(callback, 1);\r\n};\r\n\r\nfunction flush () {\r\n  while (index < queue.length) {\r\n    let currentIndex = index;\r\n    index = index + 1;\r\n    queue[currentIndex].call();\r\n\r\n    if (index > capacity) {\r\n      for (let scan = 0, newLength = queue.length - index; scan < newLength; scan++) {\r\n        queue[scan] = queue[scan + index];\r\n      }\r\n      queue.length -= index;\r\n      index = 0;\r\n    }\r\n  }\r\n  queue.length = 0;\r\n  index = 0;\r\n  // flushing = false;\r\n}\r\n\r\nexport default function asap (task) {\r\n  if (!queue.length) {\r\n    requestFlush();\r\n    // flushing = true;\r\n  }\r\n  // Equivalent to push, but avoids a function call.\r\n  queue[queue.length] = task;\r\n}\r\n","\r\nimport { resolverError, constructorError, resolveSelfError, cannotReturnOwn } from './error';\r\nimport { isObject, isFunction, noop } from './utils';\r\nimport asap from './asap';\r\n\r\nconst PENDING = void 0; // undefined\r\nconst FULFILLED = 1;\r\nconst REJECTED = 2;\r\n\r\nlet id = 0;\r\nexport default function Promise (resolver) {\r\n  if (!(this instanceof Promise)) {\r\n    throw constructorError();\r\n  }\r\n  if (typeof resolver !== 'function') {\r\n    throw resolverError();\r\n  }\r\n\r\n  this['[[PromiseStatus]]'] = PENDING;\r\n  this['[[PromiseValue]]'] = undefined;\r\n  this.subscribes = [];\r\n  this.tid = id++;\r\n\r\n  this.initializePromise(resolver);\r\n}\r\n\r\nPromise.prototype.initializePromise = function (resolver) {\r\n  try {\r\n    resolver(\r\n      value => {\r\n        mockResolve(this, value);\r\n      },\r\n      reason => {\r\n        mockReject(this, reason);\r\n      }\r\n    );\r\n  } catch (e) {\r\n    mockReject(this, e);\r\n  }\r\n  return null;\r\n};\r\n\r\nPromise.prototype.fulfill = function (value) {\r\n  if (this['[[PromiseStatus]]'] !== PENDING) {\r\n    return;\r\n  }\r\n  this['[[PromiseStatus]]'] = FULFILLED;\r\n  this['[[PromiseValue]]'] = value;\r\n\r\n  if (this.subscribes.length !== 0) {\r\n    asap(this.publish.bind(this)); // 2.2.4  onFulfilled or onRejected must not be called until the execution context stack contains only platform code.\r\n  }\r\n};\r\n\r\nPromise.prototype.publish = function () {\r\n  const subscribes = this.subscribes;\r\n  const settled = this['[[PromiseStatus]]'];\r\n  const result = this['[[PromiseValue]]'];\r\n  if (subscribes.length === 0) {\r\n    return;\r\n  }\r\n  for (let i = 0; i < subscribes.length; i += 3) {\r\n    const item = subscribes[i];\r\n    const callback = subscribes[i + settled];\r\n    if (item) {\r\n      this.invokeCallback(settled, item, callback, result);\r\n    } else {\r\n      callback(result);\r\n    }\r\n  }\r\n  this.subscribes.length = 0;\r\n};\r\n\r\nPromise.prototype.invokeCallback = function (settled, child, callback, detail) {\r\n  let hasCallback = isFunction(callback);\r\n  let value; let error; let succeeded; let failed;\r\n\r\n  if (child['[[PromiseStatus]]'] !== PENDING) {\r\n    return;\r\n  }\r\n\r\n  if (hasCallback) {\r\n    try {\r\n      value = callback(detail);\r\n      succeeded = true;\r\n    } catch (e) {\r\n      error = { error: e, };\r\n      failed = true;\r\n    }\r\n    /*\r\n        var p = new Promise((r) => r(1))\r\n        var pp = p.then(() => {\r\n            return pp\r\n        })\r\n\r\n        is not allow\r\n    */\r\n    if (child === value) {\r\n      mockReject(child, cannotReturnOwn());\r\n    }\r\n  } else {\r\n    /*\r\n        var p = new Promise( (r)=>r(1) )\r\n          p.then().then(()=>{\r\n        })\r\n        There is empty then()\r\n    */\r\n    value = detail;\r\n    succeeded = true;\r\n  }\r\n\r\n  if (hasCallback) {\r\n    if (succeeded) {\r\n      mockResolve(child, value);\r\n    } else if (failed) {\r\n      mockReject(child, error);\r\n    }\r\n  } else {\r\n    if (settled === FULFILLED) {\r\n      this.fulfill.call(child, value);\r\n    } else if (settled === REJECTED) {\r\n      mockReject(child, value);\r\n    }\r\n  }\r\n};\r\n\r\nPromise.prototype.then = function (onFulfilled, onRejected) {\r\n  const parent = this;\r\n  const child = new this.constructor(noop);\r\n\r\n  const state = this['[[PromiseStatus]]'];\r\n\r\n  if (state) { // 'pending' Corresponding to   undefined ，'fulfilled' Corresponding to  1，'rejected' Corresponding to  2\r\n    const callback = arguments[state - 1];\r\n    asap(() =>\r\n      this.invokeCallback(\r\n        this['[[PromiseStatus]]'],\r\n        child,\r\n        callback,\r\n        this['[[PromiseValue]]']\r\n      )\r\n    );\r\n  } else {\r\n    this.subscribe(parent, child, onFulfilled, onRejected);\r\n  }\r\n\r\n  return child;\r\n};\r\n\r\nPromise.prototype.subscribe = function (parent, child, onFulfilled, onRejected) {\r\n  let {\r\n    subscribes,\r\n    subscribes: { length, },\r\n  } = parent;\r\n  subscribes[length] = child;\r\n  subscribes[length + FULFILLED] = onFulfilled;\r\n  subscribes[length + REJECTED] = onRejected;\r\n  if (length === 0 && parent['[[PromiseStatus]]']) {\r\n    asap(this.publish.bind(this));\r\n  }\r\n};\r\n\r\nPromise.prototype.handleThenable = function (value) {\r\n  let then;\r\n  try {\r\n    then = value.then;\r\n  } catch (e) {\r\n    mockReject(this, { error: e, });\r\n    return;\r\n  }\r\n\r\n  // true Promise\r\n  if (isThenable(value)) {\r\n    this.handlePromise(value);\r\n    return;\r\n  }\r\n\r\n  // // 如果 then 是函数，则检验 then 方法的合法性\r\n  if (isFunction(then)) {\r\n    this.handleForeignThenable(value, then);\r\n    return;\r\n  }\r\n  // normal data\r\n  this.fulfill(value);\r\n};\r\n\r\nPromise.prototype.handleForeignThenable = function (thenable, then) {\r\n  asap(() => {\r\n    let sealed = false;\r\n    const error = tryThen(\r\n      then,\r\n      thenable,\r\n      value => {\r\n        if (sealed) {\r\n          return;\r\n        }\r\n        sealed = true;\r\n        if (thenable !== value) {\r\n          mockResolve(this, value);\r\n        } else {\r\n          this.fulfill(value);\r\n        }\r\n      },\r\n      reason => {\r\n        if (sealed) {\r\n          return;\r\n        }\r\n        sealed = true;\r\n        mockReject(this, reason);\r\n      }\r\n    );\r\n\r\n    if (!sealed && error) {\r\n      sealed = true;\r\n      mockReject(this, error);\r\n    }\r\n  });\r\n};\r\n\r\nPromise.prototype.handlePromise = function (promise) {\r\n  const state = promise['[[PromiseStatus]]'];\r\n  const result = promise['[[PromiseValue]]'];\r\n\r\n  if (state === FULFILLED) {\r\n    this.fulfill(result);\r\n    return;\r\n  }\r\n  if (state === REJECTED) {\r\n    mockReject(this, result);\r\n    return;\r\n  }\r\n  this.subscribe(\r\n    promise,\r\n    undefined,\r\n    value => mockResolve(this, value),\r\n    reason => mockReject(this, reason)\r\n  );\r\n};\r\n\r\nfunction mockResolve (promise, value) {\r\n  if (promise === value) {\r\n    mockReject(promise, resolveSelfError()); // 2.3.1、If promise and x refer to the same object, reject promise with a TypeError as the reason\r\n  } else if (isObject(value) || isFunction(value)) { // handle the thenable\r\n    promise.handleThenable(value);\r\n  } else {\r\n    promise.fulfill(value);\r\n  }\r\n}\r\n\r\nfunction mockReject (promise, reason) {\r\n  if (promise['[[PromiseStatus]]'] !== PENDING) { return; }\r\n\r\n  promise['[[PromiseStatus]]'] = REJECTED;\r\n  promise['[[PromiseValue]]'] = reason;\r\n  asap(promise.publish.bind(promise));\r\n}\r\n\r\nfunction isThenable (value) {\r\n  const sameConstructor = value.constructor === Promise;\r\n  const sameThen = value.then === Promise.prototype.then;\r\n  // const sameResolve = value.constructor.resolve === Promise.resolve;\r\n  return sameConstructor && sameThen;\r\n}\r\n\r\nfunction tryThen (then, thenable, resolvePromise, rejectPromise) {\r\n  try {\r\n    then.call(thenable, resolvePromise, rejectPromise);\r\n  } catch (e) {\r\n    return e;\r\n  }\r\n}\r\n\r\nPromise.resolve = function (object) {\r\n  let Constructor = this;\r\n\r\n  if (object && typeof object === 'object' && object.constructor === Constructor) {\r\n    return object;\r\n  }\r\n\r\n  let promise = new Constructor(noop);\r\n  mockResolve(promise, object);\r\n  return promise;\r\n};\r\n\r\nPromise.reject = function (reason) {\r\n  let Constructor = this;\r\n  let promise = new Constructor(noop);\r\n  mockReject(promise, reason);\r\n  return promise;\r\n};\r\n","import Promise from './promise/promise.js';\r\n\r\n// import asap from './promise/asap';\r\n\r\n// let p = new Promise((resolve) => {\r\n//   setTimeout(() => {\r\n//     resolve(1);\r\n//   }, 2222);\r\n// }).then((n) => {\r\n//   console.log(n);\r\n// });\r\n\r\nconst p1 = new Promise((resolve) => {\r\n  const obj = {\r\n    then: function (fn) {\r\n      fn(1);\r\n    },\r\n  };\r\n\r\n  resolve(obj);\r\n}).then(data => {\r\n  console.log(data);\r\n});\r\n"],"names":["const","let","this"],"mappings":"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"}