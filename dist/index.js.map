{"version":3,"file":"index.js","sources":["../src/promise/utils.js","../src/promise/asap.js","../src/promise/error.js","../src/promise/promise.js","../src/index.js"],"sourcesContent":["const isObject = function (val) {\n  return val !== null && typeof val === 'object';\n};\n\nconst isFunction = function (val) {\n  return toString.call(val) === '[object Function]';\n};\n\nconst noop = function () {}\n;\n\nmodule.exports = {\n  isObject, isFunction, noop,\n}\n;\n","\nlet queue = [];\nlet index = 0;\n// let flushing = false;\nlet capacity = 1024;\n\nconst browserWindow = (typeof window !== 'undefined') ? window : undefined;\nconst browserGlobal = browserWindow || {};\nconst BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\n\nconst requestFlush = (function () {\n  if (BrowserMutationObserver) {\n    return makeMutationObserver(flush);\n  } else {\n    return makeMutationTimeout(flush);\n  }\n})();\n\nfunction makeMutationObserver (callback) {\n  let toggle = 1;\n  const observer = new BrowserMutationObserver(callback);\n  const node = document.createTextNode('');\n  observer.observe(node, { characterData: true, });\n  return function () {\n    node.data = --toggle;\n  };\n};\n\nfunction makeMutationTimeout (callback) {\n  return function () { setTimeout(callback, 1); };\n};\n\nfunction flush () {\n  while (index < queue.length) {\n    let currentIndex = index;\n    index = index + 1;\n    queue[currentIndex].call();\n\n    if (index > capacity) {\n      for (let scan = 0, newLength = queue.length - index; scan < newLength; scan++) {\n        queue[scan] = queue[scan + index];\n      }\n      queue.length -= index;\n      index = 0;\n    }\n  }\n  queue.length = 0;\n  index = 0;\n  // flushing = false;\n}\n\nfunction asap (task) {\n  if (!queue.length) {\n    requestFlush();\n    // flushing = true;\n  }\n  // Equivalent to push, but avoids a function call.\n  queue[queue.length] = task;\n}\n\nmodule.exports = asap;\n","const constructorErrorText = 'Failed to construct \\'Promise\\': Please use the \\'new\\' operator, this object constructor cannot be called as a function.';\nconst resolverErrorText = 'You must pass a resolver function as the first argument to the promise constructor';\nconst resolveSelfErrorText = 'You cannot resolve a promise with itself';\nconst cannotReturnOwnText = 'A promises callback cannot return that same promise.';\nconst validationErrorText = 'Array Methods must be provided an Array';\nconst needsResolverText = 'You must pass a resolver function as the first argument to the promise constructor';\n\nconst constructorError = function () { return new TypeError(constructorErrorText); };\n\nconst resolverError = function () { return new TypeError(resolverErrorText); };\n\nconst resolveSelfError = function () { return new TypeError(resolveSelfErrorText); };\n\nconst cannotReturnOwn = function () { return new TypeError(cannotReturnOwnText); };\n\nconst validationError = function () { return new Error(validationErrorText); };\n\nconst needsResolver = function () { return new TypeError(needsResolverText); };\n\nmodule.exports = {\n  constructorError, resolverError, resolveSelfError, cannotReturnOwn, validationError, needsResolver,\n};\n","\nconst { isObject, isFunction, noop, } = require('./utils');\nconst asap = require('./asap');\nconst { resolverError, constructorError, resolveSelfError, cannotReturnOwn, } = require('./error');\n\nconst PENDING = void 0; // undefined\nconst FULFILLED = 1;\nconst REJECTED = 2;\n\nlet id = 0;\nfunction Promise (resolver) {\n  if (!(this instanceof Promise)) {\n    throw constructorError();\n  }\n  if (typeof resolver !== 'function') {\n    throw resolverError();\n  }\n\n  this['[[PromiseStatus]]'] = PENDING;\n  this['[[PromiseValue]]'] = undefined;\n  this.subscribes = [];\n  this.tid = id++;\n\n  this.initializePromise(resolver);\n}\n\nPromise.prototype.initializePromise = function (resolver) {\n  const self = this;\n  try {\n    resolver(\n      function (value) {\n        mockResolve(self, value);\n      },\n      function (reason) {\n        mockReject(self, reason);\n      }\n    );\n  } catch (e) {\n    mockReject(self, e);\n  }\n  return null;\n};\n\nPromise.prototype.fulfill = function (value) {\n  if (this['[[PromiseStatus]]'] !== PENDING) {\n    return;\n  }\n  this['[[PromiseStatus]]'] = FULFILLED;\n  this['[[PromiseValue]]'] = value;\n\n  if (this.subscribes.length !== 0) {\n    asap(this.publish.bind(this)); // 2.2.4  onFulfilled or onRejected must not be called until the execution context stack contains only platform code.\n  }\n};\n\nPromise.prototype.publish = function () {\n  const subscribes = this.subscribes;\n  const settled = this['[[PromiseStatus]]'];\n  const result = this['[[PromiseValue]]'];\n  if (subscribes.length === 0) {\n    return;\n  }\n  for (let i = 0; i < subscribes.length; i += 3) {\n    const item = subscribes[i];\n    const callback = subscribes[i + settled];\n    if (item) {\n      this.invokeCallback(settled, item, callback, result);\n    } else {\n      callback(result);\n    }\n  }\n  this.subscribes.length = 0;\n};\n\nPromise.prototype.invokeCallback = function (settled, child, callback, detail) {\n  let hasCallback = isFunction(callback);\n  let value; let error; let succeeded; let failed;\n\n  if (child['[[PromiseStatus]]'] !== PENDING) {\n    return;\n  }\n\n  if (hasCallback) {\n    try {\n      value = callback(detail);\n      succeeded = true;\n    } catch (e) {\n      error = { error: e, };\n      failed = true;\n    }\n    /*\n        var p = new Promise((r) => r(1))\n        var pp = p.then(() => {\n            return pp\n        })\n\n        is not allow\n    */\n    if (child === value) {\n      mockReject(child, cannotReturnOwn());\n    }\n  } else {\n    /*\n        var p = new Promise( (r)=>r(1) )\n          p.then().then(()=>{\n        })\n        There is empty then()\n    */\n    value = detail;\n    succeeded = true;\n  }\n\n  if (hasCallback) {\n    if (succeeded) {\n      mockResolve(child, value);\n    } else if (failed) {\n      mockReject(child, error.error);\n    }\n  } else {\n    if (settled === FULFILLED) {\n      this.fulfill.call(child, value);\n    } else if (settled === REJECTED) {\n      mockReject(child, value);\n    }\n  }\n};\n\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  const parent = this;\n  const self = this;\n  const child = new this.constructor(noop);\n\n  const state = this['[[PromiseStatus]]'];\n\n  if (state) { // 'pending' Corresponding to   undefined ，'fulfilled' Corresponding to  1，'rejected' Corresponding to  2\n    const callback = arguments[state - 1];\n    asap(function () {\n      self.invokeCallback(\n        self['[[PromiseStatus]]'],\n        child,\n        callback,\n        self['[[PromiseValue]]']\n      )\n      ;\n    }\n    );\n  } else {\n    this.subscribe(parent, child, onFulfilled, onRejected);\n  }\n\n  return child;\n};\n\nPromise.prototype.subscribe = function (parent, child, onFulfilled, onRejected) {\n  let {\n    subscribes,\n    subscribes: { length, },\n  } = parent;\n  subscribes[length] = child;\n  subscribes[length + FULFILLED] = onFulfilled;\n  subscribes[length + REJECTED] = onRejected;\n  if (length === 0 && parent['[[PromiseStatus]]']) {\n    asap(this.publish.bind(this));\n  }\n};\n\nPromise.prototype.handleThenable = function (value) {\n  let then;\n  try {\n    then = value.then;\n  } catch (e) {\n    mockReject(this, e);\n    return;\n  }\n\n  // true Promise\n  if (isThenable(value, then)) {\n    this.handlePromise(value);\n    return;\n  }\n\n  // // 如果 then 是函数，则检验 then 方法的合法性\n  if (isFunction(then)) {\n    this.handleForeignThenable(value, then);\n    return;\n  }\n  // normal data\n  this.fulfill(value);\n};\n\nPromise.prototype.handleForeignThenable = function (thenable, then) {\n  const self = this;\n  asap(function () {\n    let sealed = false;\n    const error = tryThen(\n      then,\n      thenable,\n      function (value) {\n        if (sealed) {\n          return;\n        }\n        sealed = true;\n        if (thenable !== value) {\n          mockResolve(self, value);\n        } else {\n          self.fulfill(value);\n        }\n      },\n      function (reason) {\n        if (sealed) {\n          return;\n        }\n        sealed = true;\n        mockReject(self, reason);\n      }\n    );\n\n    if (!sealed && error) {\n      sealed = true;\n      mockReject(self, error);\n    }\n  });\n};\n\nPromise.prototype.handlePromise = function (promise) {\n  const state = promise['[[PromiseStatus]]'];\n  const result = promise['[[PromiseValue]]'];\n  const self = this;\n\n  if (state === FULFILLED) {\n    this.fulfill(result);\n    return;\n  }\n  if (state === REJECTED) {\n    mockReject(this, result);\n    return;\n  }\n  this.subscribe(\n    promise,\n    undefined,\n    function (value) { mockResolve(self, value); },\n    function (reason) { mockReject(self, reason); }\n  );\n};\n\nfunction mockResolve (promise, value) {\n  if (promise === value) {\n    mockReject(promise, resolveSelfError()); // 2.3.1、If promise and x refer to the same object, reject promise with a TypeError as the reason\n  } else if (isObject(value) || isFunction(value)) { // handle the thenable\n    promise.handleThenable(value);\n  } else {\n    promise.fulfill(value);\n  }\n}\n\nfunction mockReject (promise, reason) {\n  if (promise['[[PromiseStatus]]'] !== PENDING) { return; }\n\n  promise['[[PromiseStatus]]'] = REJECTED;\n  promise['[[PromiseValue]]'] = reason;\n  asap(promise.publish.bind(promise));\n}\n\nfunction isThenable (value, then) {\n  const sameConstructor = value.constructor === Promise;\n  const sameThen = then === Promise.prototype.then;\n  // const sameResolve = value.constructor.resolve === Promise.resolve;\n  return sameConstructor && sameThen;\n}\n\nfunction tryThen (then, thenable, resolvePromise, rejectPromise) {\n  try {\n    then.call(thenable, resolvePromise, rejectPromise);\n  } catch (e) {\n    return e;\n  }\n}\n\nPromise.resolve = function (object) {\n  let Constructor = this;\n\n  if (object && typeof object === 'object' && object.constructor === Constructor) {\n    return object;\n  }\n\n  let promise = new Constructor(noop);\n  mockResolve(promise, object);\n  return promise;\n};\n\nPromise.reject = function (reason) {\n  let Constructor = this;\n  let promise = new Constructor(noop);\n  mockReject(promise, reason);\n  return promise;\n};\n\nmodule.exports = Promise;\n","const Promise = require('./promise/promise.js');\n\n// import asap from './promise/asap';\n\n// let p = new Promise((resolve) => {\n//   setTimeout(() => {\n//     resolve(1);\n//   }, 2222);\n// }).then((n) => {\n//   console.log(n);\n// });\n\nconst p1 = new Promise((resolve) => {\n  const obj = {\n    then: function (fn) {\n      fn(1);\n    },\n  };\n\n  resolve(obj);\n}).then(data => {\n  console.log(data);\n});\n"],"names":["const","let","constructorError","resolverError","asap","isFunction","cannotReturnOwn","noop","resolveSelfError","isObject","Promise"],"mappings":"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"}