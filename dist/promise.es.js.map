{"version":3,"file":"promise.es.js","sources":["../src/promise/utils.js","../src/promise/asap.js","../src/promise/error.js","../src/promise/promise.js"],"sourcesContent":["const isObject = function (val) {\n  return val !== null && typeof val === 'object';\n};\n\nconst isFunction = function (val) {\n  return toString.call(val) === '[object Function]';\n};\n\nconst noop = function () {}\n;\n\nmodule.exports = {\n  isObject, isFunction, noop,\n}\n;\n","\nlet queue = [];\nlet index = 0;\n// let flushing = false;\nlet capacity = 1024;\n\nconst browserWindow = (typeof window !== 'undefined') ? window : undefined;\nconst browserGlobal = browserWindow || {};\nconst BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\n\nconst requestFlush = (function () {\n  if (BrowserMutationObserver) {\n    return makeMutationObserver(flush);\n  } else {\n    return makeMutationTimeout(flush);\n  }\n})();\n\nfunction makeMutationObserver (callback) {\n  let toggle = 1;\n  const observer = new BrowserMutationObserver(callback);\n  const node = document.createTextNode('');\n  observer.observe(node, { characterData: true, });\n  return function () {\n    node.data = --toggle;\n  };\n};\n\nfunction makeMutationTimeout (callback) {\n  return function () { setTimeout(callback, 1); };\n};\n\nfunction flush () {\n  while (index < queue.length) {\n    let currentIndex = index;\n    index = index + 1;\n    queue[currentIndex].call();\n\n    if (index > capacity) {\n      for (let scan = 0, newLength = queue.length - index; scan < newLength; scan++) {\n        queue[scan] = queue[scan + index];\n      }\n      queue.length -= index;\n      index = 0;\n    }\n  }\n  queue.length = 0;\n  index = 0;\n  // flushing = false;\n}\n\nfunction asap (task) {\n  if (!queue.length) {\n    requestFlush();\n    // flushing = true;\n  }\n  // Equivalent to push, but avoids a function call.\n  queue[queue.length] = task;\n}\n\nmodule.exports = asap;\n","const constructorErrorText = 'Failed to construct \\'Promise\\': Please use the \\'new\\' operator, this object constructor cannot be called as a function.';\nconst resolverErrorText = 'You must pass a resolver function as the first argument to the promise constructor';\nconst resolveSelfErrorText = 'You cannot resolve a promise with itself';\nconst cannotReturnOwnText = 'A promises callback cannot return that same promise.';\nconst validationErrorText = 'Array Methods must be provided an Array';\nconst needsResolverText = 'You must pass a resolver function as the first argument to the promise constructor';\n\nconst constructorError = function () { return new TypeError(constructorErrorText); };\n\nconst resolverError = function () { return new TypeError(resolverErrorText); };\n\nconst resolveSelfError = function () { return new TypeError(resolveSelfErrorText); };\n\nconst cannotReturnOwn = function () { return new TypeError(cannotReturnOwnText); };\n\nconst validationError = function () { return new Error(validationErrorText); };\n\nconst needsResolver = function () { return new TypeError(needsResolverText); };\n\nmodule.exports = {\n  constructorError, resolverError, resolveSelfError, cannotReturnOwn, validationError, needsResolver,\n};\n","\nconst { isObject, isFunction, noop, } = require('./utils');\nconst asap = require('./asap');\nconst { resolverError, constructorError, resolveSelfError, cannotReturnOwn, } = require('./error');\n\nconst PENDING = void 0; // undefined\nconst FULFILLED = 1;\nconst REJECTED = 2;\n\nlet id = 0;\nfunction Promise (resolver) {\n  if (!(this instanceof Promise)) {\n    throw constructorError();\n  }\n  if (typeof resolver !== 'function') {\n    throw resolverError();\n  }\n\n  this['[[PromiseStatus]]'] = PENDING;\n  this['[[PromiseValue]]'] = undefined;\n  this.subscribes = [];\n  this.tid = id++;\n\n  this.initializePromise(resolver);\n}\n\nPromise.prototype.initializePromise = function (resolver) {\n  const self = this;\n  try {\n    resolver(\n      function (value) {\n        mockResolve(self, value);\n      },\n      function (reason) {\n        mockReject(self, reason);\n      }\n    );\n  } catch (e) {\n    mockReject(self, e);\n  }\n  return null;\n};\n\nPromise.prototype.fulfill = function (value) {\n  if (this['[[PromiseStatus]]'] !== PENDING) {\n    return;\n  }\n  this['[[PromiseStatus]]'] = FULFILLED;\n  this['[[PromiseValue]]'] = value;\n\n  if (this.subscribes.length !== 0) {\n    asap(this.publish.bind(this)); // 2.2.4  onFulfilled or onRejected must not be called until the execution context stack contains only platform code.\n  }\n};\n\nPromise.prototype.publish = function () {\n  const subscribes = this.subscribes;\n  const settled = this['[[PromiseStatus]]'];\n  const result = this['[[PromiseValue]]'];\n  if (subscribes.length === 0) {\n    return;\n  }\n  for (let i = 0; i < subscribes.length; i += 3) {\n    const item = subscribes[i];\n    const callback = subscribes[i + settled];\n    if (item) {\n      this.invokeCallback(settled, item, callback, result);\n    } else {\n      callback(result);\n    }\n  }\n  this.subscribes.length = 0;\n};\n\nPromise.prototype.invokeCallback = function (settled, child, callback, detail) {\n  let hasCallback = isFunction(callback);\n  let value; let error; let succeeded; let failed;\n\n  if (child['[[PromiseStatus]]'] !== PENDING) {\n    return;\n  }\n\n  if (hasCallback) {\n    try {\n      value = callback(detail);\n      succeeded = true;\n    } catch (e) {\n      error = { error: e, };\n      failed = true;\n    }\n    /*\n        var p = new Promise((r) => r(1))\n        var pp = p.then(() => {\n            return pp\n        })\n\n        is not allow\n    */\n    if (child === value) {\n      mockReject(child, cannotReturnOwn());\n    }\n  } else {\n    /*\n        var p = new Promise( (r)=>r(1) )\n          p.then().then(()=>{\n        })\n        There is empty then()\n    */\n    value = detail;\n    succeeded = true;\n  }\n\n  if (hasCallback) {\n    if (succeeded) {\n      mockResolve(child, value);\n    } else if (failed) {\n      mockReject(child, error.error);\n    }\n  } else {\n    if (settled === FULFILLED) {\n      this.fulfill.call(child, value);\n    } else if (settled === REJECTED) {\n      mockReject(child, value);\n    }\n  }\n};\n\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  const parent = this;\n  const self = this;\n  const child = new this.constructor(noop);\n\n  const state = this['[[PromiseStatus]]'];\n\n  if (state) { // 'pending' Corresponding to   undefined ，'fulfilled' Corresponding to  1，'rejected' Corresponding to  2\n    const callback = arguments[state - 1];\n    asap(function () {\n      self.invokeCallback(\n        self['[[PromiseStatus]]'],\n        child,\n        callback,\n        self['[[PromiseValue]]']\n      )\n      ;\n    }\n    );\n  } else {\n    this.subscribe(parent, child, onFulfilled, onRejected);\n  }\n\n  return child;\n};\n\nPromise.prototype.subscribe = function (parent, child, onFulfilled, onRejected) {\n  let {\n    subscribes,\n    subscribes: { length, },\n  } = parent;\n  subscribes[length] = child;\n  subscribes[length + FULFILLED] = onFulfilled;\n  subscribes[length + REJECTED] = onRejected;\n  if (length === 0 && parent['[[PromiseStatus]]']) {\n    asap(this.publish.bind(this));\n  }\n};\n\nPromise.prototype.handleThenable = function (value) {\n  let then;\n  try {\n    then = value.then;\n  } catch (e) {\n    mockReject(this, e);\n    return;\n  }\n\n  // true Promise\n  if (isThenable(value, then)) {\n    this.handlePromise(value);\n    return;\n  }\n\n  // // 如果 then 是函数，则检验 then 方法的合法性\n  if (isFunction(then)) {\n    this.handleForeignThenable(value, then);\n    return;\n  }\n  // normal data\n  this.fulfill(value);\n};\n\nPromise.prototype.handleForeignThenable = function (thenable, then) {\n  const self = this;\n  asap(function () {\n    let sealed = false;\n    const error = tryThen(\n      then,\n      thenable,\n      function (value) {\n        if (sealed) {\n          return;\n        }\n        sealed = true;\n        if (thenable !== value) {\n          mockResolve(self, value);\n        } else {\n          self.fulfill(value);\n        }\n      },\n      function (reason) {\n        if (sealed) {\n          return;\n        }\n        sealed = true;\n        mockReject(self, reason);\n      }\n    );\n\n    if (!sealed && error) {\n      sealed = true;\n      mockReject(self, error);\n    }\n  });\n};\n\nPromise.prototype.handlePromise = function (promise) {\n  const state = promise['[[PromiseStatus]]'];\n  const result = promise['[[PromiseValue]]'];\n  const self = this;\n\n  if (state === FULFILLED) {\n    this.fulfill(result);\n    return;\n  }\n  if (state === REJECTED) {\n    mockReject(this, result);\n    return;\n  }\n  this.subscribe(\n    promise,\n    undefined,\n    function (value) { mockResolve(self, value); },\n    function (reason) { mockReject(self, reason); }\n  );\n};\n\nPromise.prototype.catch = function (onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.finally = function (callback) {\n  if (typeof callback !== 'function') {\n    return this;\n  }\n  let p = this.constructor;\n  return this.then(callback, callback);\n\n  // function resolve (value) {\n  //   function yes () {\n  //     return value;\n  //   }\n  //   return p.resolve(callback()).then(yes);\n  // }\n  // function reject (reason) {\n  //   function no () {\n  //     throw reason;\n  //   }\n  //   return p.resolve(callback()).then(no);\n  // }\n};\n\nfunction mockResolve (promise, value) {\n  if (promise === value) {\n    mockReject(promise, resolveSelfError()); // 2.3.1、If promise and x refer to the same object, reject promise with a TypeError as the reason\n  } else if (isObject(value) || isFunction(value)) { // handle the thenable\n    promise.handleThenable(value);\n  } else {\n    promise.fulfill(value);\n  }\n}\n\nfunction mockReject (promise, reason) {\n  if (promise['[[PromiseStatus]]'] !== PENDING) { return; }\n\n  promise['[[PromiseStatus]]'] = REJECTED;\n  promise['[[PromiseValue]]'] = reason;\n  asap(promise.publish.bind(promise));\n}\n\nfunction isThenable (value, then) {\n  const sameConstructor = value.constructor === Promise;\n  const sameThen = then === Promise.prototype.then;\n  // const sameResolve = value.constructor.resolve === Promise.resolve;\n  return sameConstructor && sameThen;\n}\n\nfunction tryThen (then, thenable, resolvePromise, rejectPromise) {\n  try {\n    then.call(thenable, resolvePromise, rejectPromise);\n  } catch (e) {\n    return e;\n  }\n}\n\nPromise.resolve = function (object) {\n  let Constructor = this;\n\n  if (object && typeof object === 'object' && object.constructor === Constructor) {\n    return object;\n  }\n\n  let promise = new Constructor(noop);\n  mockResolve(promise, object);\n  return promise;\n};\n\nPromise.reject = function (reason) {\n  let Constructor = this;\n  let promise = new Constructor(noop);\n  mockReject(promise, reason);\n  return promise;\n};\n\nmodule.exports = Promise;\n"],"names":["const","let","constructorError","resolverError","asap","isFunction","cannotReturnOwn","noop","resolveSelfError","isObject"],"mappings":"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"}